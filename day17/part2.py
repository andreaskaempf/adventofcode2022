# Advent of Code 2022, Day 17, Part 2

# A semi-manual solution to Part 2. Basically accumulated the
# deltas in height as each rock is added, then looked for a
# repeating pattern after a certain prefix. This is done by
# part2() in the Go code.

# In the sample input, the prefix block  has 15 deltas, summing to 25.
# For each repeating block, there are 35 deltas summing to 53.
# This was first found by manual inspection, shown here:
#
# Prefix: 1 3 2 1 2 1 3 2 2 0 1 3 2 0 2 
# Repeating pattern (first 3 instances):
# 1 3 3 4 0 1 2 3 0 1 1 3 2 2 0 0 2 3 4 0 1 2 1 2 0 1 2 1 2 0 1 3 2 0 0 
# 1 3 3 4 0 1 2 3 0 1 1 3 2 2 0 0 2 3 4 0 1 2 1 2 0 1 2 1 2 0 1 3 2 0 0 
# 1 3 3 4 0 1 2 3 0 1 1 3 2 2 0 0 2 3 4 0 1 2 1 2 0 1 2 1 2 0 1 3 2 0 0 
#
# So in the first block, there are 15 deltas, summing to 25.
# For each repeating block, there are 35 deltas summing to 53.
# These are used in the Python math below to come up with the
# answer.
#
# Values were similarly derived for the main input file.

# Specify parameters for the calculation
Z = 1000000000000 # Number of rocks for which we want to calculate height (given)

# Values for sample in problem
PrefixSize = 15 # number of rocks before repeating pattern begins
PrefixSum = 25 # Height of the first block, from first 15 rocks
BlockSize = 35  # The number of rocks in each repeating block
BlockSum = 53  # The sum of the deltas

# These are the value for the problem input
if True:
    PrefixSize = 240
    PrefixSum = 365
    BlockSize = 1740
    BlockSum = 2681

# The numbers in the block, only required for input (not required for sample)
Sequence = [1, 3, 2, 2, 0, 0, 2, 3, 2, 0, 1, 3, 2, 4, 2, 1, 0, 3, 4, 0, 1, 3, 0, 2, 2, 1,
 3, 2, 0, 0, 1, 3, 2, 2, 2, 0, 0, 3, 2, 0, 1, 3, 2, 2, 0, 1, 3, 0, 2, 0, 0, 2,
 2, 0, 0, 1, 3, 0, 2, 2, 0, 3, 0, 0, 0, 1, 3, 2, 2, 0, 1, 3, 2, 1, 0, 1, 1, 2,
 2, 0, 0, 2, 2, 2, 0, 1, 3, 0, 2, 0, 1, 2, 3, 2, 2, 1, 3, 2, 4, 0, 1, 3, 2, 2,
 0, 1, 3, 2, 2, 0, 1, 3, 3, 2, 2, 1, 2, 1, 3, 0, 0, 3, 3, 2, 0, 1, 3, 3, 2, 0,
 1, 2, 3, 0, 0, 0, 2, 1, 0, 2, 1, 3, 3, 0, 2, 1, 3, 3, 0, 0, 1, 3, 2, 2, 0, 0,
 0, 3, 2, 0, 0, 2, 3, 2, 0, 1, 2, 2, 2, 2, 1, 3, 0, 4, 2, 1, 2, 1, 3, 2, 0, 3,
 3, 2, 2, 1, 3, 2, 2, 2, 1, 2, 3, 4, 0, 0, 2, 2, 2, 0, 1, 0, 0, 4, 0, 1, 3, 2,
 4, 2, 1, 3, 3, 0, 0, 1, 3, 3, 4, 0, 0, 0, 3, 0, 2, 0, 0, 3, 1, 0, 1, 3, 2, 4,
 0, 1, 3, 2, 4, 2, 1, 3, 3, 0, 0, 0, 0, 3, 0, 0, 0, 2, 3, 4, 0, 1, 3, 3, 2, 2,
 1, 3, 2, 2, 0, 1, 3, 2, 2, 0, 1, 3, 3, 0, 2, 1, 3, 3, 0, 0, 1, 2, 1, 2, 2, 0,
 0, 2, 0, 0, 1, 3, 0, 2, 2, 0, 0, 3, 4, 0, 1, 3, 0, 2, 0, 1, 3, 3, 0, 0, 1, 2,
 2, 0, 0, 1, 3, 2, 1, 1, 1, 3, 0, 1, 1, 1, 2, 2, 1, 1, 1, 0, 3, 0, 0, 1, 3, 2,
 0, 0, 1, 0, 3, 1, 0, 0, 3, 3, 2, 2, 1, 2, 3, 2, 0, 1, 0, 0, 2, 0, 1, 2, 2, 2,
 0, 0, 3, 0, 3, 0, 1, 2, 3, 2, 0, 1, 3, 2, 0, 0, 1, 3, 2, 2, 2, 1, 3, 3, 0, 0,
 1, 0, 3, 2, 2, 1, 3, 3, 0, 0, 1, 1, 2, 2, 2, 1, 2, 3, 0, 0, 1, 3, 2, 4, 2, 1,
 2, 1, 3, 2, 0, 0, 3, 0, 2, 1, 3, 0, 3, 2, 0, 0, 3, 2, 0, 1, 3, 2, 1, 2, 1, 2,
 1, 3, 2, 1, 3, 2, 0, 0, 1, 2, 3, 2, 0, 0, 2, 2, 0, 0, 1, 1, 2, 1, 1, 1, 3, 2,
 2, 0, 1, 3, 2, 0, 0, 1, 2, 2, 2, 0, 1, 3, 2, 4, 0, 0, 2, 2, 0, 0, 0, 2, 3, 2,
 0, 1, 3, 2, 4, 2, 1, 3, 3, 4, 0, 1, 2, 1, 2, 0, 0, 2, 2, 4, 0, 1, 2, 1, 3, 2,
 0, 2, 0, 4, 0, 0, 0, 3, 0, 2, 1, 2, 2, 2, 2, 1, 3, 2, 2, 0, 1, 3, 3, 0, 0, 0,
 2, 0, 4, 0, 1, 3, 3, 2, 0, 1, 2, 2, 2, 0, 1, 3, 2, 0, 0, 0, 3, 3, 0, 0, 1, 3,
 3, 4, 0, 1, 2, 2, 4, 0, 1, 3, 3, 2, 2, 1, 3, 2, 0, 0, 1, 3, 2, 2, 0, 1, 0, 3,
 4, 0, 1, 3, 2, 0, 0, 1, 2, 3, 0, 1, 0, 3, 0, 3, 0, 1, 3, 0, 2, 2, 1, 3, 2, 1,
 1, 1, 3, 3, 2, 0, 1, 3, 3, 0, 2, 1, 3, 3, 0, 2, 1, 3, 2, 0, 0, 1, 2, 3, 2, 2,
 1, 3, 3, 0, 0, 1, 0, 3, 4, 0, 1, 3, 2, 0, 1, 1, 3, 0, 2, 0, 1, 2, 2, 2, 2, 1,
 3, 2, 1, 0, 1, 2, 3, 2, 0, 1, 3, 2, 0, 0, 1, 3, 3, 2, 2, 1, 3, 3, 2, 2, 1, 2,
 1, 0, 0, 1, 3, 3, 0, 0, 1, 3, 3, 0, 2, 1, 3, 0, 3, 0, 1, 3, 2, 2, 2, 0, 3, 3,
 2, 2, 1, 0, 3, 2, 2, 1, 3, 2, 2, 0, 1, 3, 2, 1, 0, 1, 2, 3, 2, 0, 1, 2, 2, 4,
 2, 1, 3, 2, 4, 2, 1, 0, 3, 2, 2, 1, 2, 1, 0, 2, 1, 2, 1, 3, 2, 1, 2, 1, 2, 2,
 1, 3, 3, 0, 2, 0, 2, 2, 0, 2, 1, 1, 2, 1, 2, 1, 3, 3, 0, 2, 1, 3, 0, 0, 0, 1,
 2, 2, 2, 0, 1, 3, 3, 0, 2, 1, 3, 2, 1, 1, 0, 3, 3, 2, 0, 1, 2, 3, 0, 0, 1, 3,
 3, 2, 2, 1, 2, 3, 0, 0, 1, 3, 2, 0, 0, 1, 3, 3, 2, 0, 1, 3, 3, 4, 0, 0, 2, 2,
 2, 2, 1, 0, 3, 2, 0, 0, 2, 3, 0, 0, 0, 1, 2, 1, 0, 1, 3, 3, 2, 2, 1, 0, 3, 0,
 2, 1, 3, 3, 2, 2, 1, 3, 3, 0, 0, 0, 2, 2, 2, 2, 0, 3, 3, 2, 2, 1, 3, 3, 4, 0,
 0, 2, 0, 3, 0, 1, 3, 3, 0, 0, 0, 3, 3, 0, 0, 0, 2, 3, 0, 0, 1, 3, 2, 1, 0, 1,
 2, 3, 2, 2, 1, 3, 3, 2, 0, 1, 2, 1, 4, 2, 1, 3, 3, 4, 0, 1, 3, 3, 0, 0, 1, 3,
 2, 2, 2, 0, 0, 1, 2, 0, 1, 3, 3, 2, 0, 1, 3, 3, 2, 2, 1, 2, 3, 2, 0, 1, 2, 3,
 0, 2, 1, 3, 2, 2, 0, 0, 2, 3, 2, 2, 1, 3, 3, 4, 2, 1, 2, 3, 0, 1, 1, 3, 3, 2,
 0, 1, 2, 1, 2, 0, 0, 2, 0, 3, 2, 1, 2, 1, 2, 0, 1, 3, 2, 4, 2, 1, 2, 3, 0, 1,
 0, 1, 2, 2, 0, 0, 2, 2, 2, 0, 1, 3, 3, 0, 2, 1, 3, 3, 2, 0, 1, 2, 1, 1, 0, 1,
 3, 0, 3, 2, 1, 3, 2, 2, 0, 1, 3, 0, 1, 1, 0, 3, 0, 4, 2, 1, 3, 0, 2, 0, 1, 3,
 3, 2, 0, 1, 3, 3, 2, 0, 1, 3, 3, 2, 0, 1, 3, 3, 0, 0, 1, 3, 0, 2, 2, 1, 0, 0,
 4, 0, 1, 3, 3, 4, 0, 1, 3, 2, 2, 2, 1, 3, 0, 4, 0, 0, 2, 2, 2, 2, 1, 3, 2, 2,
 2, 0, 3, 2, 2, 2, 1, 2, 1, 2, 2, 1, 1, 3, 0, 2, 0, 3, 2, 0, 0, 1, 2, 1, 3, 2,
 0, 0, 2, 2, 2, 1, 3, 0, 2, 0, 1, 2, 2, 4, 0, 1, 0, 3, 0, 0, 1, 3, 2, 2, 0, 0,
 0, 3, 0, 0, 1, 2, 2, 2, 0, 1, 3, 2, 0, 0, 1, 3, 3, 2, 0, 1, 2, 2, 0, 2, 0, 2,
 3, 0, 2, 1, 3, 2, 2, 2, 0, 3, 3, 2, 0, 1, 3, 3, 0, 2, 0, 3, 0, 0, 2, 1, 2, 3,
 0, 0, 1, 3, 2, 2, 0, 1, 3, 3, 0, 2, 1, 2, 2, 2, 0, 1, 3, 3, 4, 0, 1, 2, 1, 4,
 2, 1, 2, 1, 3, 0, 1, 3, 2, 2, 2, 1, 3, 3, 2, 2, 1, 3, 0, 4, 2, 1, 2, 1, 2, 2,
 0, 0, 3, 0, 1, 1, 3, 2, 0, 0, 1, 3, 2, 2, 0, 1, 3, 0, 0, 1, 0, 3, 3, 4, 0, 1,
3, 2, 2, 2, 1, 3, 0, 3, 2, 1, 2, 3, 0, 2, 1, 3, 2, 4, 0, 1, 3, 3, 4, 2, 1, 3,
2, 2, 0, 1, 2, 2, 0, 2, 1, 3, 2, 0, 0, 1, 3, 0, 0, 1, 1, 3, 3, 2, 2, 1, 2, 1,
2, 0, 0, 2, 2, 2, 2, 1, 3, 0, 3, 0, 1, 2, 2, 2, 0, 1, 3, 3, 4, 2, 1, 3, 3, 2,
0, 1, 3, 3, 0, 2, 1, 3, 3, 0, 0, 1, 3, 0, 2, 0, 0, 2, 1, 3, 0, 1, 2, 3, 0, 0,
1, 3, 3, 4, 2, 1, 3, 2, 0, 0, 1, 3, 3, 0, 0, 0, 2, 1, 2, 0, 1, 2, 3, 4, 0, 1,
3, 0, 3, 0, 0, 1, 3, 2, 0, 1, 3, 0, 3, 0, 1, 2, 2, 2, 2, 1, 3, 2, 0, 0, 0, 2,
0, 2, 0, 1, 3, 2, 2, 2, 1, 3, 2, 0, 0, 1, 2, 3, 0, 0, 1, 3, 3, 0, 0, 0, 2, 2,
0, 0, 1, 1, 2, 2, 2, 1, 2, 3, 2, 0, 1, 3, 3, 0, 0, 1, 2, 1, 3, 0, 0, 3, 2, 2,
0, 1, 3, 2, 2, 0, 0, 2, 3, 2, 2, 1, 2, 2, 0, 0, 1, 2, 1, 2, 0, 1, 3, 3, 0, 0,
1, 3, 3, 2, 0, 1, 3, 3, 2, 2, 1, 3, 2, 2, 2, 1, 3, 3, 0, 2, 1, 3, 0, 3, 0, 1,
2, 1, 2, 2, 0, 0, 2, 2, 2, 1, 3, 3, 4, 2, 1, 2, 3, 2, 0, 1, 3, 3, 2, 2, 1, 2,
1, 2, 0, 1, 3, 0, 3, 0, 1, 3, 2, 2, 0, 1, 3, 0, 3, 2, 1, 3, 0, 2, 0, 1, 2, 3,
0, 0, 1, 3, 2, 2, 0, 1, 3, 3, 4, 2, 0, 3, 3, 2, 2, 1, 3, 2, 0, 0, 1, 2, 3, 0,
2, 0, 3, 0, 1, 2, 1, 2, 3, 2, 0, 0, 0, 3, 0, 0, 1, 3, 2, 2, 0, 0, 2, 3, 2, 0,
1, 3, 2, 2, 2, 1, 3, 3, 0, 0, 1, 2, 1, 3, 0, 0, 2, 2, 0, 0, 1, 3, 2, 0, 2, 1,
3, 0, 3, 0, 0, 2, 2, 1, 2, 1, 2, 3, 2, 0, 0, 2, 0, 0, 1, 1, 3, 3, 2, 2]

# Start by adding prefix sum to answer
Ans = PrefixSum 

# Remove prefix rocks from the pile
Z -= PrefixSize

# Number of repeated blocks 
nblocks = int(Z / BlockSize)

# Additional height from these blocks
Ans += nblocks * BlockSum 

# Remaining rocks after all these groups (really the modulo)
Z -= nblocks * BlockSize
print(Z, 'rocks remain')

if Z > 0:
    Ans += sum(Sequence[:Z])

print('Ans =', Ans)
print('S/b =', 1514285714288, 'for sample')

